<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Pré-Vendas - TV 4K</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0e1a;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            overflow-x: hidden;
        }
        
        .dashboard-wrapper { display: flex; flex-direction: column; align-items: center; width: 100%; }
        
        .dashboard-container {
            width: 2560px;
            height: 1200px;
            background-color: #0a0e1a;
            padding: 40px 60px;
            flex-shrink: 0;
            transform-origin: top center;
        }
        
        /* FIX: Scale corretamente em diferentes resoluções */
        .dashboard-container {
            transform: scale(calc(min(100vw / 2560, 100vh / 1200)));
            margin-bottom: calc((min(100vw / 2560, 100vh / 1200) - 1) * 1200px);
        }

        .gradient-text {
            background: linear-gradient(135deg, #10b981 0%, #3b82f6 50%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card-gradient-green {
            background: linear-gradient(135deg, rgba(16,185,129,.15) 0%, rgba(59,130,246,.05) 100%);
            border: 1px solid rgba(16,185,129,.2);
        }
        .card-gradient-blue {
            background: linear-gradient(135deg, rgba(59,130,246,.15) 0%, rgba(139,92,246,.05) 100%);
            border: 1px solid rgba(59,130,246,.2);
        }
        .card-gradient-purple {
            background: linear-gradient(135deg, rgba(139,92,246,.15) 0%, rgba(236,72,153,.05) 100%);
            border: 1px solid rgba(139,92,246,.2);
        }
        .card-gradient-orange {
            background: linear-gradient(135deg, rgba(245,158,11,.15) 0%, rgba(249,115,22,.05) 100%);
            border: 1px solid rgba(245,158,11,.2);
        }
        .card-dark {
            background: rgba(15,23,42,.6);
            border: 1px solid rgba(255,255,255,.05);
        }
        
        .badge-green  { background: rgba(16,185,129,.2);  color: #34d399; border: 1px solid rgba(16,185,129,.3); }
        .badge-blue   { background: rgba(59,130,246,.2);  color: #60a5fa; border: 1px solid rgba(59,130,246,.3); }
        .badge-purple { background: rgba(139,92,246,.2);  color: #a78bfa; border: 1px solid rgba(139,92,246,.3); }
        .badge-orange { background: rgba(245,158,11,.2);  color: #fbbf24; border: 1px solid rgba(245,158,11,.3); }
        .badge-dark-green { background: rgba(16,185,129,.15); color: #10b981; border: 1px solid rgba(16,185,129,.25); }
        .badge-dark-purple { background: rgba(139,92,246,.15); color: #8b5cf6; border: 1px solid rgba(139,92,246,.25); }
        .badge-red    { background: rgba(239,68,68,.15);  color: #ef4444; border: 1px solid rgba(239,68,68,.25); }
        
        .progress-bg { background: rgba(15,23,42,.8); }
        .progress-green  { background: linear-gradient(90deg,#10b981,#34d399); }
        .progress-blue   { background: linear-gradient(90deg,#3b82f6,#60a5fa); }
        .progress-purple { background: linear-gradient(90deg,#8b5cf6,#a78bfa); }
        .progress-orange { background: linear-gradient(90deg,#f59e0b,#fbbf24); }
        .progress-red    { background: linear-gradient(90deg,#ef4444,#f87171); }
        
        .metric-card { transition: all .3s ease; }
        
        .circular-progress {
            position: relative;
            width: 64px; height: 64px;
        }
        .circular-progress svg { transform: rotate(-90deg); }
        .circular-progress circle { fill: none; stroke-width: 4; }
        .circular-progress .bg { stroke: rgba(255,255,255,.1); }
        .circular-progress .progress { stroke-linecap: round; }
        .circular-progress .pct-label {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 700;
        }

        .chart-area { position: relative; overflow: hidden; }

        /* CONFIG SECTION */
        .config-section {
            width: 2560px;
            padding: 60px;
            background: linear-gradient(180deg,#0f172a 0%,#1e293b 100%);
            border-top: 2px solid #334155;
            /* FIX: Sem margin-top fixo — agora o wrapper controla */
        }
        .input-group { display: flex; flex-direction: column; gap: 8px; }
        .input-field {
            background: rgba(30,41,59,.8);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 12px 16px;
            color: white;
            font-size: 16px;
            width: 100%;
            transition: all .3s;
        }
        .input-field:focus { outline: none; border-color: #10b981; box-shadow: 0 0 0 3px rgba(16,185,129,.1); }
        .input-field:hover { border-color: #64748b; }
        /* FIX: readonly agora tem estilo visual diferente e cursor adequado */
        .input-field[readonly] {
            opacity: .55;
            cursor: not-allowed;
            background: rgba(15,23,42,.9);
            border-color: #334155;
            border-style: dashed;
        }

        .config-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 24px; margin-bottom: 32px; }
        .config-title { color: #94a3b8; font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: .05em; margin-bottom: 4px; }
        .config-header {
            display: flex; align-items: center; gap: 12px;
            margin-bottom: 32px; padding-bottom: 24px; border-bottom: 1px solid #334155;
        }
        .btn-salvar {
            background: linear-gradient(135deg,#10b981,#059669); color: white; border: none;
            padding: 16px 32px; border-radius: 12px; font-size: 18px; font-weight: 600;
            cursor: pointer; transition: all .3s; display: flex; align-items: center; gap: 8px;
        }
        .btn-salvar:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(16,185,129,.3); }
        .btn-reset {
            background: rgba(239,68,68,.2); color: #ef4444; border: 1px solid rgba(239,68,68,.3);
            padding: 16px 32px; border-radius: 12px; font-size: 18px; font-weight: 600;
            cursor: pointer; transition: all .3s; display: flex; align-items: center; gap: 8px;
        }
        .btn-reset:hover { background: rgba(239,68,68,.3); }
        .btn-copiar {
            background: linear-gradient(135deg,#3b82f6,#2563eb); color: white; border: none;
            padding: 16px 32px; border-radius: 12px; font-size: 18px; font-weight: 600;
            cursor: pointer; transition: all .3s; display: flex; align-items: center; gap: 8px;
        }
        .btn-copiar:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(59,130,246,.3); }
        .url-box {
            background: rgba(15,23,42,.8); border: 1px solid #475569; border-radius: 12px;
            padding: 16px; font-family: monospace; font-size: 14px; color: #94a3b8;
            word-break: break-all; margin-top: 16px; max-height: 100px; overflow-y: auto;
        }
        .status-indicator { display: inline-flex; align-items: center; gap: 6px; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status-saved   { background: rgba(16,185,129,.2); color: #34d399; }
        .status-unsaved { background: rgba(245,158,11,.2);  color: #fbbf24; }
        .toast {
            position: fixed; bottom: 32px; right: 32px;
            background: linear-gradient(135deg,#10b981,#059669);
            color: white; padding: 16px 24px; border-radius: 12px; font-weight: 600;
            display: flex; align-items: center; gap: 8px;
            opacity: 0; transform: translateY(20px);
            transition: all .3s; z-index: 1000;
        }
        .toast.show { opacity: 1; transform: translateY(0); }
        .auto-label { font-size: 11px; color: #64748b; font-style: italic; }

        /* FIX: badge nas taxas de conversão agora tem alinhamento correto */
        .badge-diff {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 4px 10px; border-radius: 6px;
            font-size: 12px; font-weight: 700;
            white-space: nowrap;
        }

        /* FIX: Animação suave nas barras de progresso */
        [id^="progress_"] { transition: width 0.5s ease; }
        circle.progress { transition: stroke-dashoffset 0.5s ease; }
    </style>
</head>
<body class="text-white">
<div class="dashboard-wrapper">

    <!-- ══════════════════ DASHBOARD PRINCIPAL ══════════════════ -->
    <div class="dashboard-container flex flex-col justify-between">

        <!-- SVG Defs globais para gradientes dos círculos -->
        <svg width="0" height="0" style="position:absolute">
            <defs>
                <linearGradient id="gradientGreen"  x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0%"   stop-color="#10b981"/>
                    <stop offset="100%" stop-color="#34d399"/>
                </linearGradient>
                <linearGradient id="gradientBlue"   x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0%"   stop-color="#3b82f6"/>
                    <stop offset="100%" stop-color="#60a5fa"/>
                </linearGradient>
                <linearGradient id="gradientPurple" x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0%"   stop-color="#8b5cf6"/>
                    <stop offset="100%" stop-color="#a78bfa"/>
                </linearGradient>
            </defs>
        </svg>

        <!-- Header -->
        <div class="flex justify-between items-start mb-6">
            <div>
                <h1 class="text-5xl font-bold gradient-text mb-2">Dashboard Pré-Vendas</h1>
                <p class="text-gray-400 text-lg flex items-center gap-3">
                    <span class="w-10 h-1 bg-emerald-500 rounded-full"></span>
                    Meta vs Realizado
                </p>
            </div>
            <div class="badge-green px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2">
                <i class="fas fa-check-circle"></i>
                Meta Mensal
                <span class="text-gray-400 text-xs ml-1">Fevereiro 2026</span>
            </div>
        </div>

        <!-- INBOUND -->
        <div class="mb-6">
            <div class="flex items-center gap-3 mb-4">
                <div class="w-1.5 h-6 bg-gradient-to-b from-emerald-400 to-blue-500 rounded-full"></div>
                <h2 class="text-xl font-bold tracking-wider text-gray-200">INBOUND</h2>
            </div>
            <div class="grid grid-cols-3 gap-5 mb-6">

                <!-- Leads -->
                <div class="card-gradient-green rounded-2xl p-5 metric-card relative overflow-hidden h-[240px] flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center border border-emerald-500/30">
                                <i class="fas fa-users text-emerald-400 text-2xl"></i>
                            </div>
                            <div>
                                <!-- FIX: badge_leads agora usa div com id correto, não span dentro -->
                                <div id="badge_leads" class="badge-green px-2 py-1 rounded text-xs font-medium inline-flex items-center gap-1 mb-1">
                                    <i class="fas fa-arrow-up text-[10px]"></i>
                                    <span id="text_leads_diff">+142</span>
                                </div>
                                <div class="text-gray-300 text-sm">Leads Captados</div>
                            </div>
                        </div>
                        <div class="circular-progress">
                            <svg width="64" height="64" viewBox="0 0 48 48">
                                <circle class="bg" cx="24" cy="24" r="20"></circle>
                                <circle id="circle_leads" class="progress" cx="24" cy="24" r="20"
                                    stroke="url(#gradientGreen)"
                                    stroke-dasharray="125.6" stroke-dashoffset="101.7"
                                    stroke-width="4" fill="none"></circle>
                            </svg>
                            <div class="pct-label text-emerald-400" id="pct_leads">19%</div>
                        </div>
                    </div>
                    <div>
                        <div class="mb-3">
                            <span id="display_leads_atual" class="text-5xl font-bold text-white">142</span>
                            <span class="text-gray-400 text-xl ml-2">/</span>
                            <span id="display_leads_meta" class="text-gray-400 text-xl">750</span>
                        </div>
                        <div class="chart-area h-14 w-full">
                            <svg class="w-full h-full" preserveAspectRatio="none" viewBox="0 0 100 40">
                                <defs>
                                    <linearGradient id="areaGreen" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="0%"   stop-color="#10b981" stop-opacity="0.4"/>
                                        <stop offset="100%" stop-color="#10b981" stop-opacity="0"/>
                                    </linearGradient>
                                </defs>
                                <path d="M0,35 Q20,30 40,25 T100,10 L100,40 L0,40 Z" fill="url(#areaGreen)"/>
                                <path d="M0,35 Q20,30 40,25 T100,10" fill="none" stroke="#10b981" stroke-width="2"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Agendas -->
                <div class="card-gradient-blue rounded-2xl p-5 metric-card relative overflow-hidden h-[240px] flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center border border-blue-500/30">
                                <i class="fas fa-phone text-blue-400 text-2xl"></i>
                            </div>
                            <div>
                                <div id="badge_agendas" class="badge-blue px-2 py-1 rounded text-xs font-medium inline-flex items-center gap-1 mb-1">
                                    <i class="fas fa-arrow-up text-[10px]"></i>
                                    <span id="text_agendas_diff">+28</span>
                                </div>
                                <div class="text-gray-300 text-sm">Agendas Realizadas</div>
                            </div>
                        </div>
                        <div class="circular-progress">
                            <svg width="64" height="64" viewBox="0 0 48 48">
                                <circle class="bg" cx="24" cy="24" r="20"></circle>
                                <circle id="circle_agendas" class="progress" cx="24" cy="24" r="20"
                                    stroke="url(#gradientBlue)"
                                    stroke-dasharray="125.6" stroke-dashoffset="104.9"
                                    stroke-width="4" fill="none"></circle>
                            </svg>
                            <div class="pct-label text-blue-400" id="pct_agendas">16%</div>
                        </div>
                    </div>
                    <div>
                        <div class="mb-3">
                            <span id="display_agendas_atual" class="text-5xl font-bold text-white">28</span>
                            <span class="text-gray-400 text-xl ml-2">/</span>
                            <span id="display_agendas_meta" class="text-gray-400 text-xl">170</span>
                        </div>
                        <div class="chart-area h-14 w-full">
                            <svg class="w-full h-full" preserveAspectRatio="none" viewBox="0 0 100 40">
                                <defs>
                                    <linearGradient id="areaBlue" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="0%"   stop-color="#3b82f6" stop-opacity="0.4"/>
                                        <stop offset="100%" stop-color="#3b82f6" stop-opacity="0"/>
                                    </linearGradient>
                                </defs>
                                <path d="M0,38 Q30,35 60,20 T100,15 L100,40 L0,40 Z" fill="url(#areaBlue)"/>
                                <path d="M0,38 Q30,35 60,20 T100,15" fill="none" stroke="#3b82f6" stroke-width="2"/>
                            </svg>
                        </div>
                    </div>
                </div>

                <!-- Qualificados -->
                <div class="card-gradient-purple rounded-2xl p-5 metric-card relative overflow-hidden h-[240px] flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <div class="flex items-center gap-3">
                            <div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center border border-purple-500/30">
                                <i class="fas fa-check-circle text-purple-400 text-2xl"></i>
                            </div>
                            <div>
                                <div id="badge_qualif" class="badge-purple px-2 py-1 rounded text-xs font-medium inline-flex items-center gap-1 mb-1">
                                    <i class="fas fa-arrow-up text-[10px]"></i>
                                    <span id="text_qualif_diff">+15</span>
                                </div>
                                <div class="text-gray-300 text-sm">Leads Qualificados</div>
                            </div>
                        </div>
                        <div class="circular-progress">
                            <svg width="64" height="64" viewBox="0 0 48 48">
                                <circle class="bg" cx="24" cy="24" r="20"></circle>
                                <circle id="circle_qualif" class="progress" cx="24" cy="24" r="20"
                                    stroke="url(#gradientPurple)"
                                    stroke-dasharray="125.6" stroke-dashoffset="112.2"
                                    stroke-width="4" fill="none"></circle>
                            </svg>
                            <div class="pct-label text-purple-400" id="pct_qualif">11%</div>
                        </div>
                    </div>
                    <div>
                        <div class="mb-3">
                            <span id="display_qualif_atual" class="text-5xl font-bold text-white">15</span>
                            <span class="text-gray-400 text-xl ml-2">/</span>
                            <span id="display_qualif_meta" class="text-gray-400 text-xl">140</span>
                        </div>
                        <div class="chart-area h-14 w-full">
                            <svg class="w-full h-full" preserveAspectRatio="none" viewBox="0 0 100 40">
                                <defs>
                                    <linearGradient id="areaPurple" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="0%"   stop-color="#8b5cf6" stop-opacity="0.4"/>
                                        <stop offset="100%" stop-color="#8b5cf6" stop-opacity="0"/>
                                    </linearGradient>
                                </defs>
                                <path d="M0,40 Q25,35 50,25 T100,5 L100,40 L0,40 Z" fill="url(#areaPurple)"/>
                                <path d="M0,40 Q25,35 50,25 T100,5" fill="none" stroke="#8b5cf6" stroke-width="2"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- OUTBOUND & YOU PARCEIRO -->
        <div class="grid grid-cols-2 gap-6 mb-6">

            <!-- OUTBOUND -->
            <div>
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-1.5 h-6 bg-gradient-to-b from-purple-400 to-pink-500 rounded-full"></div>
                    <h2 class="text-xl font-bold tracking-wider text-gray-200">OUTBOUND</h2>
                </div>
                <div class="grid grid-cols-3 gap-3">
                    <div class="card-dark rounded-xl p-3 h-[110px] flex flex-col justify-between">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-phone text-blue-400 text-lg"></i>
                                <span class="text-gray-300 text-sm">Agendas</span>
                            </div>
                            <span id="pct_out_agendas" class="text-blue-400 font-bold text-lg">20%</span>
                        </div>
                        <div>
                            <div class="flex justify-between items-end mb-2">
                                <span id="display_out_agendas_atual" class="text-3xl font-bold">9</span>
                                <span class="text-gray-500 text-sm">/</span>
                                <span id="display_out_agendas_meta" class="text-gray-500 text-sm">45</span>
                            </div>
                            <div class="progress-bg rounded-full h-1.5 overflow-hidden">
                                <div id="progress_out_agendas" class="progress-blue h-full rounded-full" style="width:20%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card-dark rounded-xl p-3 h-[110px] flex flex-col justify-between">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-clipboard-check text-purple-400 text-lg"></i>
                                <span class="text-gray-300 text-sm">Qualif.</span>
                            </div>
                            <span id="pct_out_qualif" class="text-purple-400 font-bold text-lg">19%</span>
                        </div>
                        <div>
                            <div class="flex justify-between items-end mb-2">
                                <span id="display_out_qualif_atual" class="text-3xl font-bold">7</span>
                                <span class="text-gray-500 text-sm">/</span>
                                <span id="display_out_qualif_meta" class="text-gray-500 text-sm">36</span>
                            </div>
                            <div class="progress-bg rounded-full h-1.5 overflow-hidden">
                                <div id="progress_out_qualif" class="progress-purple h-full rounded-full" style="width:19%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card-dark rounded-xl p-3 h-[110px] flex flex-col justify-between">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-bullseye text-orange-400 text-lg"></i>
                                <span class="text-gray-300 text-sm">Vendas</span>
                            </div>
                            <span id="pct_out_vendas" class="text-orange-400 font-bold text-lg">20%</span>
                        </div>
                        <div>
                            <div class="flex justify-between items-end mb-2">
                                <span id="display_out_vendas_atual" class="text-3xl font-bold">1</span>
                                <span class="text-gray-500 text-sm">/</span>
                                <span id="display_out_vendas_meta" class="text-gray-500 text-sm">5</span>
                            </div>
                            <div class="progress-bg rounded-full h-1.5 overflow-hidden">
                                <div id="progress_out_vendas" class="progress-orange h-full rounded-full" style="width:20%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- YOU PARCEIRO -->
            <div>
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-1.5 h-6 bg-gradient-to-b from-orange-400 to-red-500 rounded-full"></div>
                    <h2 class="text-xl font-bold tracking-wider text-gray-200">YOU PARCEIRO</h2>
                </div>
                <div class="grid grid-cols-3 gap-3">
                    <div class="card-dark rounded-xl p-3 h-[110px] flex flex-col justify-between">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-user-tie text-orange-400 text-lg"></i>
                                <span class="text-gray-300 text-sm">Apres.</span>
                            </div>
                            <span id="pct_you_apres" class="text-orange-400 font-bold text-lg">20%</span>
                        </div>
                        <div>
                            <div class="flex justify-between items-end mb-2">
                                <span id="display_you_apres_atual" class="text-3xl font-bold">1</span>
                                <span class="text-gray-500 text-sm">/</span>
                                <span id="display_you_apres_meta" class="text-gray-500 text-sm">5</span>
                            </div>
                            <div class="progress-bg rounded-full h-1.5 overflow-hidden">
                                <div id="progress_you_apres" class="progress-orange h-full rounded-full" style="width:20%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card-dark rounded-xl p-3 h-[110px] flex flex-col justify-between">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-file-signature text-red-400 text-lg"></i>
                                <span class="text-gray-300 text-sm">Contr.</span>
                            </div>
                            <span id="pct_you_contr" class="text-red-400 font-bold text-lg">0%</span>
                        </div>
                        <div>
                            <div class="flex justify-between items-end mb-2">
                                <span id="display_you_contr_atual" class="text-3xl font-bold">0</span>
                                <span class="text-gray-500 text-sm">/</span>
                                <span id="display_you_contr_meta" class="text-gray-500 text-sm">5</span>
                            </div>
                            <div class="progress-bg rounded-full h-1.5 overflow-hidden">
                                <div id="progress_you_contr" class="progress-red h-full rounded-full" style="width:0%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="card-dark rounded-xl p-3 h-[110px] flex flex-col justify-between">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-2">
                                <i class="fas fa-user-plus text-red-400 text-lg"></i>
                                <span class="text-gray-300 text-sm">Indic.</span>
                            </div>
                            <span id="pct_you_indic" class="text-red-400 font-bold text-lg">0%</span>
                        </div>
                        <div>
                            <div class="flex justify-between items-end mb-2">
                                <span id="display_you_indic_atual" class="text-3xl font-bold">0</span>
                                <span class="text-gray-500 text-sm">/</span>
                                <span id="display_you_indic_meta" class="text-gray-500 text-sm">5</span>
                            </div>
                            <div class="progress-bg rounded-full h-1.5 overflow-hidden">
                                <div id="progress_you_indic" class="progress-red h-full rounded-full" style="width:0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAXAS DE CONVERSÃO — 100% automáticas -->
        <div class="mb-6">
            <div class="grid grid-cols-4 gap-5">

                <!-- Lead → Qualificado -->
                <div class="card-dark rounded-2xl p-5 border-l-4 border-emerald-500 h-[160px] flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <div class="text-gray-400 text-base">Lead → Qualificado</div>
                        <!-- FIX: badge com id correto, renderizado pelo JS -->
                        <div id="badge_conv1" class="badge-diff badge-red">
                            <i class="fas fa-arrow-down text-xs"></i>
                            <span id="diff_conv1_text">-14.29%</span>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-baseline gap-2 mb-3">
                            <!-- FIX: exibe taxa calculada automaticamente -->
                            <span id="display_conv1_atual" class="text-4xl font-bold text-white">10.71%</span>
                            <span class="text-gray-500 text-sm">meta: <span id="display_conv1_meta">25%</span></span>
                        </div>
                        <!-- FIX: barra proporcional a quanto atingiu da meta -->
                        <div class="progress-bg rounded-full h-2.5 overflow-hidden">
                            <div id="progress_conv1" class="progress-purple h-full rounded-full" style="width:43%"></div>
                        </div>
                    </div>
                </div>

                <!-- Qualificado → Venda -->
                <div class="card-dark rounded-2xl p-5 border-l-4 border-purple-500 h-[160px] flex flex-col justify-between">
                    <div class="flex justify-between items-start">
                        <div class="text-gray-400 text-base">Qualificado → Venda</div>
                        <div id="badge_conv2" class="badge-diff badge-red">
                            <i class="fas fa-arrow-down text-xs"></i>
                            <span id="diff_conv2_text">-18.33%</span>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-baseline gap-2 mb-3">
                            <span id="display_conv2_atual" class="text-4xl font-bold text-white">6.67%</span>
                            <span class="text-gray-500 text-sm">meta: <span id="display_conv2_meta">25%</span></span>
                        </div>
                        <div class="progress-bg rounded-full h-2.5 overflow-hidden">
                            <div id="progress_conv2" class="progress-purple h-full rounded-full" style="width:27%"></div>
                        </div>
                    </div>
                </div>

                <!-- Vendas Realizadas -->
                <div class="card-gradient-orange rounded-2xl p-5 h-[160px] flex flex-col justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center border border-orange-500/30">
                            <i class="fas fa-fire text-orange-400 text-xl"></i>
                        </div>
                        <div class="text-gray-300 text-sm">Vendas Realizadas</div>
                    </div>
                    <div>
                        <!-- FIX: display_vendas_atual exibe com zero à esquerda -->
                        <div id="display_vendas_atual" class="text-4xl font-bold text-orange-400 mb-1">01</div>
                        <div class="text-gray-400 text-xs mb-2">Total: <span id="display_vendas_total">01</span>/<span id="display_vendas_meta2">24</span></div>
                        <div class="progress-bg rounded-full h-2.5 overflow-hidden">
                            <div id="progress_vendas" class="progress-orange h-full rounded-full" style="width:4%"></div>
                        </div>
                    </div>
                </div>

                <!-- Taxa de Conversão Geral (Leads → Vendas) -->
                <div class="card-gradient-blue rounded-2xl p-5 h-[160px] flex flex-col justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center border border-blue-500/30">
                            <i class="fas fa-rocket text-blue-400 text-xl"></i>
                        </div>
                        <div class="text-gray-300 text-sm">Taxa de Conversão</div>
                    </div>
                    <div>
                        <!-- FIX: calcula automaticamente vendasA / leadsA -->
                        <div id="display_taxa_conv" class="text-4xl font-bold text-blue-400 mb-1">0.70%</div>
                        <div class="text-gray-400 text-xs mb-2">Leads → Vendas</div>
                        <!-- FIX: barra escala a 10% = 100% da barra (escala razoável) -->
                        <div class="progress-bg rounded-full h-2.5 overflow-hidden">
                            <div id="progress_taxa_conv" class="progress-blue h-full rounded-full" style="width:7%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="card-gradient-green rounded-2xl p-4 text-center border border-emerald-500/30">
            <p class="text-emerald-300 text-lg font-medium flex items-center justify-center gap-2">
                <i class="fas fa-fire text-xl"></i>
                Pipeline aquecendo! Hora de transformar oportunidades em resultados!
            </p>
        </div>
    </div>

    <!-- ══════════════════ SEÇÃO DE CONFIGURAÇÃO ══════════════════ -->
    <div class="config-section">
        <div class="config-header">
            <i class="fas fa-cog text-4xl text-emerald-400"></i>
            <div>
                <h2 class="text-3xl font-bold text-white">Configuração de Parâmetros</h2>
                <p class="text-gray-400 mt-1">Edite os valores abaixo — o dashboard atualiza automaticamente!</p>
                <p class="text-yellow-400 text-sm mt-1">
                    <i class="fas fa-info-circle mr-1"></i>
                    Campos com borda tracejada são calculados automaticamente a partir dos outros valores.
                </p>
            </div>
            <div class="ml-auto flex items-center gap-4">
                <span id="status_indicator" class="status-indicator status-unsaved">
                    <i class="fas fa-pencil-alt"></i> Editando...
                </span>
            </div>
        </div>

        <!-- INBOUND -->
        <div class="mb-8">
            <h3 class="text-xl font-bold text-emerald-400 mb-4 flex items-center gap-2">
                <i class="fas fa-arrow-down"></i> INBOUND
            </h3>
            <div class="config-grid">
                <div class="input-group">
                    <label class="config-title">Leads Captados — Atual</label>
                    <input type="number" id="input_leads_atual" class="input-field" value="142" min="0">
                </div>
                <div class="input-group">
                    <label class="config-title">Leads Captados — Meta</label>
                    <input type="number" id="input_leads_meta" class="input-field" value="750" min="1">
                </div>
                <div class="input-group">
                    <label class="config-title">Agendas Realizadas — Atual</label>
                    <input type="number" id="input_agendas_atual" class="input-field" value="28" min="0">
                </div>
                <div class="input-group">
                    <label class="config-title">Agendas Realizadas — Meta</label>
                    <input type="number" id="input_agendas_meta" class="input-field" value="170" min="1">
                </div>
                <div class="input-group">
                    <label class="config-title">Leads Qualificados — Atual</label>
                    <input type="number" id="input_qualif_atual" class="input-field" value="15" min="0">
                </div>
                <div class="input-group">
                    <label class="config-title">Leads Qualificados — Meta</label>
                    <input type="number" id="input_qualif_meta" class="input-field" value="140" min="1">
                </div>
            </div>
        </div>

        <!-- CONVERSÕES E VENDAS — metas editáveis, taxas auto -->
        <div class="mb-8">
            <h3 class="text-xl font-bold text-purple-400 mb-4 flex items-center gap-2">
                <i class="fas fa-percentage"></i> CONVERSÕES E VENDAS
            </h3>
            <div class="config-grid">
                <!-- FIX: Conv1 atual → readonly, calculado de qualif_atual / leads_atual -->
                <div class="input-group">
                    <label class="config-title">Lead → Qualif. % <span class="auto-label">(auto)</span></label>
                    <input type="number" step="0.01" id="input_conv1_atual" class="input-field" value="10.71" readonly tabindex="-1">
                </div>
                <div class="input-group">
                    <label class="config-title">Lead → Qualif. % — Meta</label>
                    <input type="number" step="0.01" id="input_conv1_meta" class="input-field" value="25" min="0">
                </div>
                <!-- FIX: Conv2 atual → readonly, calculado de vendas_atual / qualif_atual -->
                <div class="input-group">
                    <label class="config-title">Qualif. → Venda % <span class="auto-label">(auto)</span></label>
                    <input type="number" step="0.01" id="input_conv2_atual" class="input-field" value="6.67" readonly tabindex="-1">
                </div>
                <div class="input-group">
                    <label class="config-title">Qualif. → Venda % — Meta</label>
                    <input type="number" step="0.01" id="input_conv2_meta" class="input-field" value="25" min="0">
                </div>
                <div class="input-group">
                    <label class="config-title">Vendas Realizadas — Atual</label>
                    <input type="number" id="input_vendas_atual" class="input-field" value="1" min="0">
                </div>
                <div class="input-group">
                    <label class="config-title">Vendas Realizadas — Meta</label>
                    <input type="number" id="input_vendas_meta" class="input-field" value="24" min="1">
                </div>
                <!-- FIX: Taxa geral → readonly, calculado de vendas_atual / leads_atual -->
                <div class="input-group">
                    <label class="config-title">Conversão Geral % <span class="auto-label">(auto)</span></label>
                    <input type="number" step="0.01" id="input_taxa_conv" class="input-field" value="0.70" readonly tabindex="-1">
                </div>
            </div>
        </div>

        <!-- OUTBOUND -->
        <div class="mb-8">
            <h3 class="text-xl font-bold text-blue-400 mb-4 flex items-center gap-2">
                <i class="fas fa-phone"></i> OUTBOUND
            </h3>
            <div class="config-grid">
                <div class="input-group">
                    <label class="config-title">Agendas — Atual</label>
                    <input type="number" id="input_out_agendas_atual" class="input-field" value="9" min="0">
                </div>
                <div class="input-group">
                    <label class="config-title">Agendas — Meta</label>
                    <input type="number" id="input_out_agendas_meta" class="input-field" value="45" min="1">
                </div>
                <div class="input-group">
                    <label class="config-title">Qualificações — Atual</label>
                    <input type="number" id="input_out_qualif_atual" class="input-field" value="7" min="0">
                </div>
                <div class="input-group">
                    <label class="config-title">Qualificações — Meta</label>
                    <input type="number" id="input_out_qualif_meta" class="input-field" value="36" min="1">
                </div>
                <div class="input-group">
                    <label class="config-title">Vendas — Atual</label>
                    <input type="number" id="input_out_vendas_atual" class="input-field" value="1" min="0">
                </div>
                <div class="input-group">
                    <label class="config-title">Vendas — Meta</label>
                    <input type="number" id="input_out_vendas_meta" class="input-field" value="5" min="1">
                </div>
            </div>
        </div>

        <!-- YOU PARCEIRO -->
        <div class="mb-8">
            <h3 class="text-xl font-bold text-orange-400 mb-4 flex items-center gap-2">
                <i class="fas fa-handshake"></i> YOU PARCEIRO
            </h3>
            <div class="config-grid">
                <div class="input-group">
                    <label class="config-title">Apresentações — Atual</label>
                    <input type="number" id="input_you_apres_atual" class="input-field" value="1" min="0">
                </div>
                <div class="input-group">
                    <label class="config-title">Apresentações — Meta</label>
                    <input type="number" id="input_you_apres_meta" class="input-field" value="5" min="1">
                </div>
                <div class="input-group">
                    <label class="config-title">Contratos — Atual</label>
                    <input type="number" id="input_you_contr_atual" class="input-field" value="0" min="0">
                </div>
                <div class="input-group">
                    <label class="config-title">Contratos — Meta</label>
                    <input type="number" id="input_you_contr_meta" class="input-field" value="5" min="1">
                </div>
                <div class="input-group">
                    <label class="config-title">Indicações — Atual</label>
                    <input type="number" id="input_you_indic_atual" class="input-field" value="0" min="0">
                </div>
                <div class="input-group">
                    <label class="config-title">Indicações — Meta</label>
                    <input type="number" id="input_you_indic_meta" class="input-field" value="5" min="1">
                </div>
            </div>
        </div>

        <!-- BOTÕES -->
        <div class="flex justify-center gap-4 mt-8 flex-wrap">
            <button class="btn-salvar" onclick="gerarLink()">
                <i class="fas fa-link"></i> Gerar Link com Dados
            </button>
            <button class="btn-copiar" onclick="copiarLink()">
                <i class="fas fa-copy"></i> Copiar Link
            </button>
            <button class="btn-reset" onclick="resetarValores()">
                <i class="fas fa-undo"></i> Resetar Padrão
            </button>
        </div>

        <div class="mt-6">
            <label class="config-title">Link Gerado (compartilhe este link):</label>
            <div id="url_gerada" class="url-box">Clique em "Gerar Link" para criar uma URL compartilhável com seus dados</div>
        </div>
    </div>
</div>

<!-- TOAST -->
<div id="toast" class="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toast_msg">Link copiado com sucesso!</span>
</div>

<script>
// ─── Valores padrão (apenas campos editáveis pelo usuário) ────────
const valoresPadrao = {
    leads_atual: 142,   leads_meta: 750,
    agendas_atual: 28,  agendas_meta: 170,
    qualif_atual: 15,   qualif_meta: 140,
    conv1_meta: 25,
    conv2_meta: 25,
    vendas_atual: 1,    vendas_meta: 24,
    out_agendas_atual: 9,  out_agendas_meta: 45,
    out_qualif_atual: 7,   out_qualif_meta: 36,
    out_vendas_atual: 1,   out_vendas_meta: 5,
    you_apres_atual: 1,    you_apres_meta: 5,
    you_contr_atual: 0,    you_contr_meta: 5,
    you_indic_atual: 0,    you_indic_meta: 5
};

// Campos readonly — nunca lidos da URL, sempre recalculados
const camposAuto = ['input_conv1_atual', 'input_conv2_atual', 'input_taxa_conv'];

// ─── Helpers ─────────────────────────────────────────────────────
function pct(atual, meta) {
    if (!meta || meta === 0) return 0;
    return (atual / meta) * 100;
}

function clamp(val, min = 0, max = 100) {
    return Math.min(Math.max(val, min), max);
}

// FIX: getBadgeClass agora funciona tanto para inbound quanto para taxas
function getBadgeClass(p) {
    if (p >= 80) return 'badge-green';
    if (p >= 60) return 'badge-blue';
    if (p >= 40) return 'badge-orange';
    return 'badge-red';
}

function setCircle(id, pctVal) {
    const circumference = 125.6;
    const offset = circumference - (circumference * clamp(pctVal) / 100);
    document.getElementById(id).style.strokeDashoffset = offset.toFixed(1);
}

/**
 * FIX: setBadgeDiff agora usa o id do contêiner e o id do span separados.
 * diff = valorAtual - metaValor (em pontos percentuais)
 */
function setBadgeDiff(containerId, textId, diff) {
    const el = document.getElementById(containerId);
    const span = document.getElementById(textId);
    const positive = diff >= 0;
    const sign = positive ? '+' : '';
    const icon = positive ? 'fa-arrow-up' : 'fa-arrow-down';
    const cls = positive ? 'badge-diff badge-dark-green' : 'badge-diff badge-red';
    el.className = cls;
    el.innerHTML = `<i class="fas ${icon} text-xs"></i><span>${sign}${Math.abs(diff).toFixed(2)}%</span>`;
}

function val(id)  { return parseFloat(document.getElementById(id).value) || 0; }
function ival(id) { return parseInt(document.getElementById(id).value)   || 0; }

// ─── Função principal de atualização ────────────────────────────
function atualizarDashboard() {

    // ── Leitura dos inputs manuais ──
    const leadsA   = ival('input_leads_atual');
    const leadsM   = ival('input_leads_meta')   || 1;
    const agendasA = ival('input_agendas_atual');
    const agendasM = ival('input_agendas_meta') || 1;
    const qualifA  = ival('input_qualif_atual');
    const qualifM  = ival('input_qualif_meta')  || 1;
    const vendasA  = ival('input_vendas_atual');
    const vendasM  = ival('input_vendas_meta')  || 1;
    const conv1M   = val('input_conv1_meta')    || 1;
    const conv2M   = val('input_conv2_meta')    || 1;

    // ── FIX: Cálculo automático das três taxas de conversão ──
    // Lead → Qualificado %
    const conv1A = leadsA > 0 ? (qualifA / leadsA) * 100 : 0;
    // Qualificado → Venda %
    const conv2A = qualifA > 0 ? (vendasA / qualifA) * 100 : 0;
    // Leads → Vendas % (taxa geral)
    const taxaConv = leadsA > 0 ? (vendasA / leadsA) * 100 : 0;

    // Atualiza campos readonly para que gerarLink() também os inclua
    document.getElementById('input_conv1_atual').value = conv1A.toFixed(2);
    document.getElementById('input_conv2_atual').value = conv2A.toFixed(2);
    document.getElementById('input_taxa_conv').value   = taxaConv.toFixed(2);

    // ── INBOUND — Leads ──
    const leadsP = pct(leadsA, leadsM);
    document.getElementById('display_leads_atual').textContent = leadsA;
    document.getElementById('display_leads_meta').textContent  = leadsM;
    document.getElementById('pct_leads').textContent           = Math.round(leadsP) + '%';
    // FIX: badge_leads innerHTML atualizado corretamente, sem perder o ícone
    document.getElementById('badge_leads').className =
        getBadgeClass(leadsP) + ' px-2 py-1 rounded text-xs font-medium inline-flex items-center gap-1 mb-1';
    document.getElementById('badge_leads').innerHTML =
        `<i class="fas fa-arrow-up text-[10px]"></i><span>+${leadsA}</span>`;
    setCircle('circle_leads', leadsP);

    // ── INBOUND — Agendas ──
    const agendasP = pct(agendasA, agendasM);
    document.getElementById('display_agendas_atual').textContent = agendasA;
    document.getElementById('display_agendas_meta').textContent  = agendasM;
    document.getElementById('pct_agendas').textContent           = Math.round(agendasP) + '%';
    document.getElementById('badge_agendas').className =
        getBadgeClass(agendasP) + ' px-2 py-1 rounded text-xs font-medium inline-flex items-center gap-1 mb-1';
    document.getElementById('badge_agendas').innerHTML =
        `<i class="fas fa-arrow-up text-[10px]"></i><span>+${agendasA}</span>`;
    setCircle('circle_agendas', agendasP);

    // ── INBOUND — Qualificados ──
    const qualifP = pct(qualifA, qualifM);
    document.getElementById('display_qualif_atual').textContent = qualifA;
    document.getElementById('display_qualif_meta').textContent  = qualifM;
    document.getElementById('pct_qualif').textContent           = Math.round(qualifP) + '%';
    document.getElementById('badge_qualif').className =
        getBadgeClass(qualifP) + ' px-2 py-1 rounded text-xs font-medium inline-flex items-center gap-1 mb-1';
    document.getElementById('badge_qualif').innerHTML =
        `<i class="fas fa-arrow-up text-[10px]"></i><span>+${qualifA}</span>`;
    setCircle('circle_qualif', qualifP);

    // ── FIX: Conversão 1 — Lead → Qualificado (totalmente automático) ──
    const diff1 = conv1A - conv1M;
    document.getElementById('display_conv1_atual').textContent = conv1A.toFixed(2) + '%';
    document.getElementById('display_conv1_meta').textContent  = conv1M.toFixed(2) + '%';
    // Barra: quanto da meta foi atingida
    document.getElementById('progress_conv1').style.width = clamp(conv1M > 0 ? (conv1A / conv1M) * 100 : 0) + '%';
    // Badge: diferença entre atual e meta
    setBadgeDiff('badge_conv1', 'diff_conv1_text', diff1);

    // ── FIX: Conversão 2 — Qualificado → Venda (totalmente automático) ──
    const diff2 = conv2A - conv2M;
    document.getElementById('display_conv2_atual').textContent = conv2A.toFixed(2) + '%';
    document.getElementById('display_conv2_meta').textContent  = conv2M.toFixed(2) + '%';
    document.getElementById('progress_conv2').style.width = clamp(conv2M > 0 ? (conv2A / conv2M) * 100 : 0) + '%';
    setBadgeDiff('badge_conv2', 'diff_conv2_text', diff2);

    // ── Vendas ──
    const vendasP = pct(vendasA, vendasM);
    document.getElementById('display_vendas_atual').textContent = String(vendasA).padStart(2, '0');
    document.getElementById('display_vendas_total').textContent = String(vendasA).padStart(2, '0');
    document.getElementById('display_vendas_meta2').textContent = vendasM;
    document.getElementById('progress_vendas').style.width = clamp(vendasP) + '%';

    // ── FIX: Taxa de conversão geral — automática ──
    document.getElementById('display_taxa_conv').textContent = taxaConv.toFixed(2) + '%';
    // Barra: escala onde 10% = barra cheia (taxa de 10% já seria excelente)
    document.getElementById('progress_taxa_conv').style.width = clamp(taxaConv * 10) + '%';

    // ── OUTBOUND — Agendas ──
    const outAgA = ival('input_out_agendas_atual');
    const outAgM = ival('input_out_agendas_meta') || 1;
    const outAgP = pct(outAgA, outAgM);
    document.getElementById('display_out_agendas_atual').textContent = outAgA;
    document.getElementById('display_out_agendas_meta').textContent  = outAgM;
    document.getElementById('pct_out_agendas').textContent = Math.round(outAgP) + '%';
    document.getElementById('progress_out_agendas').style.width = clamp(outAgP) + '%';

    // ── OUTBOUND — Qualif ──
    const outQA = ival('input_out_qualif_atual');
    const outQM = ival('input_out_qualif_meta') || 1;
    const outQP = pct(outQA, outQM);
    document.getElementById('display_out_qualif_atual').textContent = outQA;
    document.getElementById('display_out_qualif_meta').textContent  = outQM;
    document.getElementById('pct_out_qualif').textContent = Math.round(outQP) + '%';
    document.getElementById('progress_out_qualif').style.width = clamp(outQP) + '%';

    // ── OUTBOUND — Vendas ──
    const outVA = ival('input_out_vendas_atual');
    const outVM = ival('input_out_vendas_meta') || 1;
    const outVP = pct(outVA, outVM);
    document.getElementById('display_out_vendas_atual').textContent = outVA;
    document.getElementById('display_out_vendas_meta').textContent  = outVM;
    document.getElementById('pct_out_vendas').textContent = Math.round(outVP) + '%';
    document.getElementById('progress_out_vendas').style.width = clamp(outVP) + '%';

    // ── YOU PARCEIRO — Apresentações ──
    const yApA = ival('input_you_apres_atual');
    const yApM = ival('input_you_apres_meta') || 1;
    const yApP = pct(yApA, yApM);
    document.getElementById('display_you_apres_atual').textContent = yApA;
    document.getElementById('display_you_apres_meta').textContent  = yApM;
    document.getElementById('pct_you_apres').textContent = Math.round(yApP) + '%';
    document.getElementById('progress_you_apres').style.width = clamp(yApP) + '%';

    // ── YOU PARCEIRO — Contratos ──
    const yCnA = ival('input_you_contr_atual');
    const yCnM = ival('input_you_contr_meta') || 1;
    const yCnP = pct(yCnA, yCnM);
    document.getElementById('display_you_contr_atual').textContent = yCnA;
    document.getElementById('display_you_contr_meta').textContent  = yCnM;
    document.getElementById('pct_you_contr').textContent = Math.round(yCnP) + '%';
    document.getElementById('progress_you_contr').style.width = clamp(yCnP) + '%';

    // ── YOU PARCEIRO — Indicações ──
    const yInA = ival('input_you_indic_atual');
    const yInM = ival('input_you_indic_meta') || 1;
    const yInP = pct(yInA, yInM);
    document.getElementById('display_you_indic_atual').textContent = yInA;
    document.getElementById('display_you_indic_meta').textContent  = yInM;
    document.getElementById('pct_you_indic').textContent = Math.round(yInP) + '%';
    document.getElementById('progress_you_indic').style.width = clamp(yInP) + '%';
}

// ─── Event listeners ─────────────────────────────────────────────
function adicionarListeners() {
    // FIX: escuta apenas inputs editáveis (não readonly)
    document.querySelectorAll('.input-field:not([readonly])').forEach(input => {
        input.addEventListener('input',  atualizarDashboard);
        input.addEventListener('change', atualizarDashboard);
    });
}

// ─── Gerar link ──────────────────────────────────────────────────
function gerarLink() {
    atualizarDashboard(); // garante campos readonly atualizados antes de gerar

    const params = new URLSearchParams();

    // FIX: só serializa campos editáveis (evita poluir URL com campos auto)
    Object.keys(valoresPadrao).forEach(key => {
        const el = document.getElementById('input_' + key);
        if (el && el.value !== '') params.set(key, el.value);
    });

    const url = new URL(window.location.href);
    url.search = params.toString();
    window.history.replaceState({}, '', url);
    document.getElementById('url_gerada').textContent = url.toString();
    document.getElementById('status_indicator').className = 'status-indicator status-saved';
    document.getElementById('status_indicator').innerHTML = '<i class="fas fa-check-circle"></i> Link gerado!';
    showToast('Link gerado com sucesso!');
}

function copiarLink() {
    const urlText = document.getElementById('url_gerada').textContent;
    if (!urlText.includes('http')) { showToast('Gere o link primeiro!', true); return; }
    navigator.clipboard.writeText(urlText)
        .then(() => showToast('Link copiado para a área de transferência!'))
        .catch(() => {
            const ta = document.createElement('textarea');
            ta.value = urlText;
            document.body.appendChild(ta);
            ta.select();
            document.execCommand('copy');
            document.body.removeChild(ta);
            showToast('Link copiado para a área de transferência!');
        });
}

function showToast(msg, isError = false) {
    const toast = document.getElementById('toast');
    document.getElementById('toast_msg').textContent = msg;
    toast.style.background = isError
        ? 'linear-gradient(135deg,#ef4444,#dc2626)'
        : 'linear-gradient(135deg,#10b981,#059669)';
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
}

function resetarValores() {
    if (!confirm('Tem certeza que deseja resetar todos os valores para o padrão?')) return;
    Object.keys(valoresPadrao).forEach(key => {
        const el = document.getElementById('input_' + key);
        if (el) el.value = valoresPadrao[key];
    });
    atualizarDashboard();
    window.history.replaceState({}, '', window.location.pathname);
    document.getElementById('url_gerada').textContent = 'Clique em "Gerar Link" para criar uma URL compartilhável com seus dados';
    document.getElementById('status_indicator').className = 'status-indicator status-unsaved';
    document.getElementById('status_indicator').innerHTML = '<i class="fas fa-pencil-alt"></i> Editando...';
    showToast('Valores resetados para o padrão!');
}

// ─── Carregar da URL ──────────────────────────────────────────────
function carregarDaURL() {
    const params = new URLSearchParams(window.location.search);
    let hasData = false;

    params.forEach((value, key) => {
        // FIX: nunca restaura campos auto pela URL — sempre recalculados
        const elId = 'input_' + key;
        if (camposAuto.includes(elId)) return;
        const el = document.getElementById(elId);
        if (el && value !== '') {
            el.value = value;
            hasData = true;
        }
    });

    if (hasData) {
        document.getElementById('status_indicator').className = 'status-indicator status-saved';
        document.getElementById('status_indicator').innerHTML = '<i class="fas fa-check-circle"></i> Dados carregados da URL';
        document.getElementById('url_gerada').textContent = window.location.href;
    }

    adicionarListeners();
    atualizarDashboard(); // sempre recalcula ao carregar (isso preenche os campos auto)
}

window.onload = carregarDaURL;
</script>
</body>
</html>
